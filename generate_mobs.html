<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Generate Mobs</title>
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css'>
    <link rel="stylesheet" href="./style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prefixfree/1.0.7/prefixfree.min.js"></script>
</head>
<body>
<div class="container">
    <div id="result" hidden="hidden">
        <form>
            <div class="field">
                <label for="result_content">
                    <strong>Result</strong>
                    <textarea rows="20" cols="50" style="background: lightgray" id="result_content" readonly></textarea>
                </label>
            </div>
        </form>
        <br>
        <button class="button" type="button" onclick="copyText()">Copy</button>
        <button class="button" type="button" onclick="closeResult()">Close</button>
    </div>
</div>
<div class="container">
    <div id="inv" hidden="hidden">
        <form>
            <div class="field">
                <label for="inv_content">
                    <strong>Result</strong>
                    <textarea rows="10" cols="50" style="background: lightgray" id="inv_content" readonly></textarea>
                </label>
            </div>
        </form>
        <br>
        <button class="button" type="button" onclick="copyText()">Copy</button>
        <button class="button" type="button" onclick="closeResult()">Close</button>
    </div>
</div>
<div class="container">
    <form onsubmit="generateMob(); return false;">
        <div class="field">
            <label for="mob_id">
                <strong>Mob info</strong>
            </label>
        </div>

        <div class="field">
            <label for="inv_slot">
                Inventory slot
            </label>
            <input name="inv_slot" id="inv_slot" type="number" placeholder="e.g. 1" required>
        </div>

        <div class="field">
            <label for="mob_name">
                Mob Name
            </label>
            <input name="mob_name" id="mob_name" type="text" placeholder="e.g. Sand Warrior" required>
        </div>
        <div class="field">
            <label for="mob_id">
                Mob Id
            </label>
            <input name="mob_id" id="mob_id" type="text" placeholder="e.g. sand-warrior" required>
        </div>
        <div class="field">
            <label for="lore">
                Lore
            </label>
            <textarea rows="5" name="lore" id="lore" placeholder="type here" required></textarea>
        </div>
        <hr>
        <div class="field">
            <label>
                <strong>Drops</strong>
            </label>
        </div>
        <div class="field">
            <label for="artifact">
                Artifact
            </label>
            <textarea rows="5" name="artifact" id="artifact" placeholder="type here" required></textarea>
        </div>
        <div class="field">
            <label for="items">
                Items
            </label>
            <textarea rows="5" name="items" id="items" placeholder="type here" required></textarea>
        </div>
        <div class="field">
            <label for="exp">
                Exp
            </label>
            <input name="exp" id="exp" type="number" placeholder="e.g. 10" required>
        </div>

        <button class="button" type="submit">Generate Mob</button>
    </form>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>
<script>
    function generateMob() {
        let result_string = "";
        let mob_name = $("#mob_name").val();
        let mob_id = $("#mob_id").val();
        let lore = $("#lore").val();
        let lore_array = lore.split('\n');

        result_string += `    ${mob_id}:\n`;
        result_string += `        name: "&f${mob_name}"\n`;
        result_string += `        lore:\n`;
        let have_lore = false;
        lore_array.forEach((lore_line) => {
            if (lore_line !== "") {
                if (!have_lore) {
                    have_lore = true;
                }
                result_string += `        - "&7${lore_line}"\n`
            }
        });
        if (have_lore) {
            result_string += `        - ""\n`
        }

        let drop_string = "";
        let have_drop = false;

        let artifacts = $("#artifact").val();
        let artifacts_array = artifacts.split('\n');
        artifacts_array.sort(function (a, b) {
            return a[0] - b[0]
        });
        let artifacts_rarity_string = [
            '&7Artifact &8&l[&8☆☆☆☆☆&8&l]',
            '&7Artifact &8&l[&7☆&8☆☆☆☆&8&l]',
            '&7Artifact &8&l[#00cc45☆☆&8☆☆☆&8&l]',
            '&7Artifact &8&l[#00aee6☆☆☆&8☆☆&8&l]',
            '&7Artifact &8&l[#9545e6☆☆☆☆&8☆&8&l]',
            '&7Artifact &8&l[#e6b945☆☆☆☆☆&8&l]',
            '&7Artifact &8&l[#e64545☆☆☆☆☆&8&l]'
        ]
        artifacts_array.forEach((artifact_line) => {
            if (artifact_line !== "") {
                if (artifact_line.split(' ').length < 2) {
                    return "";
                }
                let artifact_data = artifact_line.split(" ");
                let artifact_rarity_code = artifact_data[0];
                let artifact_drop_chance = artifact_data[1];
                if (parseInt(artifact_rarity_code) < 0 || parseInt(artifact_rarity_code) > 6 || artifacts_rarity_string[parseInt(artifact_rarity_code)] === undefined) {
                    return '';
                }
                if (artifact_drop_chance === undefined || parseFloat(artifact_rarity_code) < 0 || parseFloat(artifact_rarity_code) > 100) {
                    return '';
                }
                let artifact_rarity_string = artifacts_rarity_string[parseInt(artifact_rarity_code)];
                drop_string += `        - "#e6a1a1&l❱ ${artifact_rarity_string} &8(${artifact_drop_chance}%)"\n`
                if (!have_drop) {
                    have_drop = true;
                }


            }
        });

        let items = $('#items').val();
        let items_array = items.split('\n');
        items_array.forEach((item_line) => {
            if (item_line.split(' ').length < 2) {
                return "";
            }
            let item_chance = getChance(item_line);
            let item_name = item_line.replace(` ${item_chance}`, "");

            if (parseFloat(item_chance) < 0 || parseFloat(item_chance) > 100) {
                return "";
            }
            drop_string += `        - "#e6a1a1&l❱ &7${item_name} &8(${item_chance}%)"\n`;
            if (!have_drop) {
                have_drop = true;
            }

        })

        let exp = $("#exp").val();
        if (exp !== "") {
            drop_string += `        - "#e6a1a1&l❱ &7${exp} Exp"\n`;
            if (!have_drop) {
                have_drop = true;
            }

        }

        if (have_drop) {
            result_string += `        - "&6Drops:"\n`;
            result_string += drop_string;
            result_string += `        - ""\n`;
        }

        result_string += `        - "&f&lClick for kill count!"\n`;
        result_string += `        discovered_on_mob_kill:\n`;
        result_string += `        mythic_mobs_id: ${mob_id}\n`;


        $("#result_content").html(result_string);

        let inv_string = "";
        let inv_slot = $('#inv_slot').val();

        inv_string += `    '${inv_slot}':\n`;
        inv_string += `      type: monsters;${mob_id}\n`;
        inv_string += `      item: PAPER\n`;
        inv_string += `      name: '&6Discovery: %name%'\n`;
        inv_string += `      lore:\n`;
        inv_string += `      - '%lore%'\n`;
        inv_string += `     click_commands:\n`;
        inv_string += `      - "goop mythicmobs runSkillAs Tell-Mob-${mob_id}-Kill %player%"\n`;

        $("#inv_content").html(inv_string);

        $("#result").show();
        $("#inv").show();
        $("html, body").animate({scrollTop: 0}, "slow");
    }

    function closeResult() {
        $("#result").hide();
        $("#inv").hide();
    }

    function copyText() {
        let copyText = document.getElementById("result_content");

        // Select the text field
        copyText.select();
        copyText.setSelectionRange(0, 99999); // For mobile devices

        // Copy the text inside the text field
        navigator.clipboard.writeText(copyText.value);
    }

    function getChance(string) {
        let string_array = string.split(" ");
        return string_array[string_array.length - 1];
    }
</script>
</body>
</html>
